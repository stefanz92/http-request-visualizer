<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTTP Request Visualizer</title>
  <style>
    body { margin:0; padding:20px; font-family: Arial, sans-serif; background-color: #f5f7fa; }
    .form-container { max-width: 800px; margin: 0 auto 20px; padding: 20px; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
    .form-group input, .form-group select, .form-group textarea { width:100%; padding:8px; border:1px solid #ccc; border-radius:5px; font-family: monospace; }
    .form-group textarea { resize:vertical; min-height:100px; }
    .btn { display:inline-block; padding:10px 20px; background:#007bff; color:#fff; border:none; border-radius:5px; cursor:pointer; font-size:16px; margin-right:10px; }
    .btn:hover { background:#0056b3; }
    .card { max-width:800px; margin:0 auto; padding:20px; background:#fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    .endpoint { font-size:18px; margin-bottom:10px; }
    .method { display:inline-block; padding:3px 8px; border-radius:3px; color:#fff; font-weight:bold; text-transform:uppercase; margin-right:10px; }
    .method.GET { background:#28a745; } .method.POST { background:#17a2b8; } .method.PUT { background:#ffc107; color:#212529; } .method.DELETE { background:#dc3545; } .method.PATCH { background:#6f42c1; }
    pre { background:#f0f0f0; padding:10px; border-radius:5px; overflow:auto; }
    .section { margin-bottom:20px; }
    .section h3 { margin-bottom:10px; font-size:16px; border-bottom:1px solid #ddd; padding-bottom:5px; }
    #share-msg { font-size:14px; color:green; display:none; vertical-align:middle; }
  </style>
</head>
<body>
  <div class="form-container" id="form-container">
    <div class="form-group">
      <label for="method">HTTP Method</label>
      <select id="method"><option>GET</option><option>POST</option><option>PUT</option><option>DELETE</option><option>PATCH</option></select>
    </div>
    <div class="form-group">
      <label for="url">Request URL</label>
      <input type="text" id="url" placeholder="https://api.example.com/v1/resource" />
    </div>
    <div class="form-group">
      <label for="request">Request Example (JSON)</label>
      <textarea id="request" placeholder='{"key": "value"}'></textarea>
    </div>
    <div class="form-group">
      <label for="response">Response Example (JSON)</label>
      <textarea id="response" placeholder='{"success": true, "data": {}}'></textarea>
    </div>
    <button class="btn" id="share">Copy Embed Code</button>
    <span id="share-msg">Embed code copied!</span>
  </div>
  <div id="visualization"></div>
  <script>
    // Helpers
    const params = new URLSearchParams(window.location.search);
    const isEmbed = params.get('embed') === 'true';
    if (isEmbed) {
      document.getElementById('form-container').style.display = 'none';
    }
    function updateQueryString(p) {
      history.replaceState(null, '', window.location.pathname + '?' + p.toString());
    }
    function generateVisualization(data, updateUrl=true) {
      const { method, url, request, response } = data;
      document.getElementById('visualization').innerHTML = `
        <div class="card">
          <div class="endpoint">
            <span class="method ${method}">${method}</span>
            <span>${url}</span>
          </div>
          <div class="section"><h3>Request Example</h3><pre>${request}</pre></div>
          <div class="section"><h3>Response Example</h3><pre>${response}</pre></div>
        </div>`;
      if (updateUrl) {
        params.set('method', method); params.set('url', url);
        params.set('request', request); params.set('response', response);
        params.set('embed', 'true');
        updateQueryString(params);
      }
    }
    // Share button
    document.getElementById('share').addEventListener('click', () => {
      const method = document.getElementById('method').value;
      const url = document.getElementById('url').value.trim();
      let req = document.getElementById('request').value.trim();
      let res = document.getElementById('response').value.trim();
      try { req = JSON.stringify(JSON.parse(req), null, 2); } catch { return alert('Invalid request JSON'); }
      try { res = JSON.stringify(JSON.parse(res), null, 2); } catch { return alert('Invalid response JSON'); }
      const data = { method, url, request: req, response: res };
      generateVisualization(data);
      const src = window.location.origin + window.location.pathname + '?' + params.toString();
      const embedCode = `<iframe src="${src}" style="width:100%; height:400px; border:0;"></iframe>`;
      navigator.clipboard.writeText(embedCode).then(() => {
        const msg = document.getElementById('share-msg'); msg.style.display='inline';
        setTimeout(() => msg.style.display='none',2000);
      });
    });
    // On load render if embed params present
    if (params.has('url') && isEmbed) {
      try {
        const data = {
          method: params.get('method'),
          url: params.get('url'),
          request: JSON.stringify(JSON.parse(params.get('request')), null, 2),
          response: JSON.stringify(JSON.parse(params.get('response')), null, 2)
        };
        generateVisualization(data, false);
      } catch { console.warn('Could not parse params'); }
    }
  </script>
</body>
</html>
